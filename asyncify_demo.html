<dialog id="promptDialog">
  10 + <input type="number" id="number" /><input
    type="button"
    value="="
    id="closeDialog"
  />
</dialog>

<script type="module">
  import Asyncify from './asyncify.js';

  const dialogElem = document.getElementById('promptDialog');
  const numberElem = document.getElementById('number');
  const closeDialogElem = document.getElementById('closeDialog');

  closeDialogElem.onclick = () => dialogElem.close();

  function asyncPrompt() {
    return new Promise(resolve => {
      dialogElem.onclose = () => resolve(numberElem.valueAsNumber);
      dialogElem.showModal();
    });
  }

  (async () => {
    let asyncify = new Asyncify();

    let { instance } = await WebAssembly.instantiateStreaming(
      fetch('./asyncify_demo_rs.wasm'),
      asyncify.wrapImports({
        env: {
          prompt: asyncPrompt
        }
      })
    );

    let exports = asyncify.wrapExports(instance.exports);

    console.log(await exports.add(10));
  })();
</script>
